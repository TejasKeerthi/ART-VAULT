<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtVault | Digital Art Showcase</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <style>
        /* Custom styles inspired by Foundation.app */
        body {
            background-color: #0D0D0D;
            color: #F5F5F5;
            font-family: 'Inter', sans-serif;
        }
        
        /* Custom scrollbar for a polished look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Style for the 3D model viewer and gallery images */
        model-viewer, .gallery-image {
            width: 100%;
            height: 400px;
            border-radius: 1rem;
            background-color: #1a1a1a;
            object-fit: cover; /* Ensures images cover the area nicely */
        }
        
        .modal-container, #notification-banner { transition: opacity 0.3s ease, transform 0.3s ease; }
        .placeholder-text { color: #666; text-align: center; }
        
        .card-overlay {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .group:hover .card-overlay { opacity: 1; }

        /* NEW: Canvas style for remix modal */
        #remix-canvas {
            border: 2px dashed #444;
            border-radius: 0.5rem;
            background-color: #000;
            cursor: crosshair; /* Indicate drawing */
        }
    </style>
</head>
<body class="antialiased">

    <header class="sticky top-0 z-50 bg-black/50 backdrop-blur-lg border-b border-gray-800">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold tracking-wider">
                ArtVault <span class="text-purple-400">.</span>
            </div>
            <div id="header-actions" class="flex items-center space-x-4">
                </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">Explore the Collection</h1>
            <p class="text-lg text-gray-400">Own a piece of the future. The world's finest digital art awaits.</p>
        </div>

        <div id="gallery-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            
            <div class="group relative" data-description="Crimson Tide. An abstract digital painting with swirling patterns of red, black, and gold." data-image-url="https://placehold.co/600x800/2D033B/FFFFFF?text=Crimson+Tide">
                <img src="https://placehold.co/600x800/2D033B/FFFFFF?text=Crimson+Tide" alt="Abstract digital art" class="gallery-image">
                <div class="absolute inset-0 bg-black/60 card-overlay rounded-lg flex items-center justify-center space-x-2">
                    <button class="audio-btn p-3 bg-white/20 rounded-full hover:bg-white/30 transition-colors" aria-label="Play audio description">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                    </button>
                    <button class="remix-btn p-3 bg-white/20 rounded-full hover:bg-white/30 transition-colors" aria-label="Remix this art">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z" /></svg>
                    </button>
                    <button class="buy-now-btn font-bold bg-purple-600 text-white py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors">Buy Now</button>
                </div>
                <div class="mt-4 flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold">Crimson Tide</h3>
                        <p class="text-gray-400">By AuraFlow</p>
                    </div>
                    <div class="text-lg font-bold flex items-center gap-1">
                        <svg class="w-5 h-5" viewBox="0 0 320 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M311.9 260.8L160 353.6 8 260.8 160 0l151.9 260.8zM160 383.4L8 290.6 160 512l152-221.4-152 92.8z"/></svg>
                        0.5 ETH
                    </div>
                </div>
            </div>

            <div class="group relative" data-description="The Scholar. A detailed 3D sculpture of an astronaut." data-image-url="https://modelviewer.dev/shared-assets/models/Astronaut.png"> 
                <model-viewer src="https://modelviewer.dev/shared-assets/models/Astronaut.glb" alt="A 3D model of an astronaut" camera-controls auto-rotate shadow-intensity="1" poster="https://modelviewer.dev/shared-assets/models/Astronaut.png"></model-viewer>
                <div class="absolute inset-0 bg-black/60 card-overlay rounded-lg flex items-center justify-center space-x-2">
                    <button class="audio-btn p-3 bg-white/20 rounded-full hover:bg-white/30 transition-colors" aria-label="Play audio description">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                    </button>
                    <button class="remix-btn p-3 bg-white/20 rounded-full hover:bg-white/30 transition-colors" aria-label="Remix this art">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z" /></svg>
                    </button>
                    <button class="buy-now-btn font-bold bg-purple-600 text-white py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors">Buy Now</button>
                </div>
                <div class="mt-4 flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold">The Scholar (3D)</h3>
                        <p class="text-gray-400">By PolygonCreator</p>
                    </div>
                    <div class="text-lg font-bold flex items-center gap-1">
                        <svg class="w-5 h-5" viewBox="0 0 320 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M311.9 260.8L160 353.6 8 260.8 160 0l151.9 260.8zM160 383.4L8 290.6 160 512l152-221.4-152 92.8z"/></svg>
                        1.2 ETH
                    </div>
                </div>
            </div>

            <div class="group relative" data-description="Neon Jungle. A vibrant, synthwave-inspired illustration of a tiger." data-image-url="https://placehold.co/600x800/E94560/FFFFFF?text=Neon+Jungle">
                <img src="https://placehold.co/600x800/E94560/FFFFFF?text=Neon+Jungle" alt="Synthwave tiger art" class="gallery-image">
                <div class="absolute inset-0 bg-black/60 card-overlay rounded-lg flex items-center justify-center space-x-2">
                    <button class="audio-btn p-3 bg-white/20 rounded-full hover:bg-white/30 transition-colors" aria-label="Play audio description">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                    </button>
                    <button class="remix-btn p-3 bg-white/20 rounded-full hover:bg-white/30 transition-colors" aria-label="Remix this art">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z" /></svg>
                    </button>
                    <button class="buy-now-btn font-bold bg-purple-600 text-white py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors">Buy Now</button>
                </div>
                <div class="mt-4 flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold">Neon Jungle</h3>
                        <p class="text-gray-400">By RetroVision</p>
                    </div>
                    <div class="text-lg font-bold flex items-center gap-1">
                        <svg class="w-5 h-5" viewBox="0 0 320 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M311.9 260.8L160 353.6 8 260.8 160 0l151.9 260.8zM160 383.4L8 290.6 160 512l152-221.4-152 92.8z"/></svg>
                        0.8 ETH
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <div id="login-modal" class="modal-container fixed inset-0 z-50 bg-black/80 justify-center items-center hidden">
        <div class="bg-[#1a1a1a] rounded-xl shadow-lg w-full max-w-md p-8 relative text-center">
            <button id="close-login-modal-btn" class="absolute top-4 right-4 text-gray-500 hover:text-white transition-colors text-3xl">&times;</button>
            <h2 class="text-2xl font-bold mb-2">Join ArtVault</h2>
            <p class="text-gray-400 mb-8">Choose your role to continue.</p>
            <div class="space-y-4">
                <button id="login-creator-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">Login as a Creator</button>
                <button id="login-consumer-btn" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">Login as a Consumer</button>
            </div>
        </div>
    </div>

    <div id="create-modal" class="modal-container fixed inset-0 z-50 bg-black/80 justify-center items-center hidden">
        <div class="bg-[#1a1a1a] rounded-xl shadow-lg w-full max-w-4xl p-8 relative">
            <button id="close-create-modal-btn" class="absolute top-4 right-4 text-gray-500 hover:text-white transition-colors text-3xl">&times;</button>
            <h2 class="text-2xl font-bold mb-6">Create Your Artwork</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="space-y-6">
                    <div>
                        <label for="image-upload" class="block text-sm font-medium text-gray-300 mb-2">1. Upload Image</label>
                        <input type="file" id="image-upload" accept="image/*" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-purple-600 file:text-white hover:file:bg-purple-700 cursor-pointer"/>
                    </div>
                    <div>
                        <label for="art-title" class="block text-sm font-medium text-gray-300 mb-2">2. Artwork Title</label>
                        <input type="text" id="art-title" placeholder="e.g., 'Sunset Overdrive'" class="w-full bg-gray-800 border-gray-700 rounded-lg p-2 text-white focus:ring-purple-500 focus:border-purple-500">
                    </div>
                    <div>
                        <label for="art-price" class="block text-sm font-medium text-gray-300 mb-2">3. Set Price (ETH)</label>
                        <input type="number" id="art-price" placeholder="e.g., 0.5" step="0.01" min="0" class="w-full bg-gray-800 border-gray-700 rounded-lg p-2 text-white focus:ring-purple-500 focus:border-purple-500">
                    </div>
                    <div>
                        <label for="art-description" class="block text-sm font-medium text-gray-300 mb-2">4. Art Description</label>
                        <textarea id="art-description" rows="3" placeholder="A detailed description for the audio feature..." class="w-full bg-gray-800 border-gray-700 rounded-lg p-2 text-white focus:ring-purple-500 focus:border-purple-500"></textarea>
                    </div>
                    <button id="add-to-gallery-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">Add to Gallery</button>
                </div>
                <div id="create-preview-container" class="rounded-lg bg-black min-h-[300px] flex items-center justify-center">
                    <p class="placeholder-text">Your 3D preview will appear here</p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="remix-modal" class="modal-container fixed inset-0 z-50 bg-black/80 justify-center items-center hidden">
        <div class="bg-[#1a1a1a] rounded-xl shadow-lg w-full max-w-4xl p-8 relative">
            <button id="close-remix-modal-btn" class="absolute top-4 right-4 text-gray-500 hover:text-white transition-colors text-3xl">&times;</button>
            <h2 class="text-2xl font-bold mb-6">Remix Artwork</h2>
            <div class="flex justify-center mb-4">
                <canvas id="remix-canvas" width="600" height="400"></canvas>
            </div>
            <div class="flex justify-center items-center space-x-4">
                <button id="save-remix-btn" class="w-1/2 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    Save Remix & Mint
                </button>
            </div>
        </div>
    </div>

    <footer class="border-t border-gray-800 mt-20">
        <div class="container mx-auto px-6 py-8 text-center text-gray-500">
            <h4 class="font-semibold mb-2">Project Team</h4>
            <div class="flex justify-center space-x-4">
                <span>KEERTHI TEJAS</span>
                <span>MANDADAPU LOKESH</span>
                <span>SHLOK JELLA</span>
            </div>
            <p class="mt-6">&copy; 2025 ArtVault.</p>
        </div>
    </footer>
    
    <div id="notification-banner" class="fixed bottom-5 right-5 bg-green-500 text-white py-3 px-5 rounded-lg shadow-lg transform translate-y-20 opacity-0">
        Item purchased successfully!
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const headerActions = document.getElementById('header-actions');
            const galleryGrid = document.getElementById('gallery-grid');
            const notificationBanner = document.getElementById('notification-banner');

            // --- UI Templates ---
            const loggedOutState = `
                <button id="show-login-modal-btn" class="font-semibold py-2 px-5 rounded-lg transition-colors text-white hover:bg-gray-800">Login</button>
                <button id="connect-wallet-btn" class="border border-gray-600 hover:bg-gray-800 text-white font-semibold py-2 px-5 rounded-lg transition-colors">Connect Wallet</button>
            `;

            const loggedInState = (role, address) => `
                ${role === 'creator' ? `
                <button id="show-create-modal-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-5 rounded-lg transition-colors">
                    Create
                </button>` : ''}
                <div class="flex items-center space-x-4">
                    <span class="bg-gray-800 text-sm text-gray-300 py-2 px-4 rounded-lg">${address}</span>
                    <button id="logout-btn" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-5 rounded-lg transition-colors">
                        Logout
                    </button>
                </div>
            `;
            
            // --- State Management ---
            function updateHeaderUI() {
                const userRole = localStorage.getItem('userRole');
                const walletAddress = localStorage.getItem('walletAddress');
                headerActions.innerHTML = (userRole && walletAddress) ? loggedInState(userRole, walletAddress) : loggedOutState;
                attachHeaderEventListeners();
            }
            
            function attachHeaderEventListeners() {
                const userRole = localStorage.getItem('userRole');
                if (userRole) {
                    document.getElementById('logout-btn').addEventListener('click', logout);
                    if (userRole === 'creator') {
                        document.getElementById('show-create-modal-btn').addEventListener('click', showCreateModal);
                    }
                } else {
                    document.getElementById('show-login-modal-btn').addEventListener('click', showLoginModal);
                    document.getElementById('connect-wallet-btn').addEventListener('click', connectWallet);
                }
            }

            // --- Wallet Connection Simulation ---
            function connectWallet() {
                const btn = document.getElementById('connect-wallet-btn');
                btn.textContent = 'Connecting...';
                setTimeout(() => {
                    // Using a custom message instead of alert()
                    showNotification('Wallet connected successfully! (Simulation)', true);
                    btn.textContent = 'Wallet Connected';
                    btn.disabled = true;
                }, 1000);
            }
            
            // --- Notification Logic ---
            function showNotification(message, isSuccess = true) {
                notificationBanner.textContent = message;
                notificationBanner.className = `fixed bottom-5 right-5 text-white py-3 px-5 rounded-lg shadow-lg transform transition-all ${isSuccess ? 'bg-green-500' : 'bg-red-500'}`;
                notificationBanner.classList.remove('translate-y-20', 'opacity-0');
                setTimeout(() => {
                    notificationBanner.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            }

            // --- Event Delegation for Gallery Actions ---
            galleryGrid.addEventListener('click', function(event) {
                const buyButton = event.target.closest('.buy-now-btn');
                const audioButton = event.target.closest('.audio-btn');
                const remixButton = event.target.closest('.remix-btn'); // NEW: Get remix button

                if (buyButton) {
                    const userRole = localStorage.getItem('userRole');
                    if (!userRole) {
                        showLoginModal();
                        return;
                    }
                    buyButton.textContent = 'Purchasing...';
                    buyButton.disabled = true;
                    setTimeout(() => {
                        buyButton.textContent = 'Owned';
                        buyButton.classList.remove('bg-purple-600', 'hover:bg-purple-700');
                        buyButton.classList.add('bg-gray-600', 'cursor-not-allowed');
                        showNotification('Artwork purchased successfully!');
                    }, 1500);
                }
                
                if (audioButton && 'speechSynthesis' in window) {
                    event.stopPropagation();
                    window.speechSynthesis.cancel(); // Stop any previous speech
                    const card = event.target.closest('.group');
                    const description = card.dataset.description;
                    if (description) {
                        const utterance = new SpeechSynthesisUtterance(description);
                        window.speechSynthesis.speak(utterance);
                    }
                }

                // NEW: Handle Remix Button Click
                if (remixButton) {
                    event.stopPropagation();
                    const userRole = localStorage.getItem('userRole');
                    if (userRole !== 'creator') {
                        showNotification('Only Creators can remix art. Please log in as a Creator.', false);
                        if (!userRole) showLoginModal(); // Show login if not logged in at all
                        return;
                    }
                    
                    const card = event.target.closest('.group');
                    // Use data-image-url which we added to all cards
                    const imageUrl = card.dataset.imageUrl; 
                    const title = card.querySelector('h3')?.textContent || 'Untitled';
                    
                    if (imageUrl) {
                        // NOTE: This will only work if the image is hosted on the same domain
                        // or has CORS (Cross-Origin Resource Sharing) headers enabled.
                        // Images from "placehold.co" *will* cause a CORS error,
                        // tainting the canvas and preventing "toDataURL()" from working.
                        // This is a browser security feature, not a code bug.
                        // For a real app, your images would be served correctly.
                        showRemixModal(imageUrl, title);

                    } else {
                        showNotification('Cannot remix this item (no image URL found).', false);
                    }
                }
            });


            // --- Login/Logout Modal Logic ---
            const loginModal = document.getElementById('login-modal');
            const closeLoginModalBtn = document.getElementById('close-login-modal-btn');
            const loginCreatorBtn = document.getElementById('login-creator-btn');
            const loginConsumerBtn = document.getElementById('login-consumer-btn');
            function showLoginModal() { loginModal.classList.remove('hidden'); loginModal.classList.add('flex'); }
            function closeLoginModal() { loginModal.classList.add('hidden'); loginModal.classList.remove('flex'); }
            function login(role) {
                const walletAddress = `0x...${Math.random().toString(16).substr(2, 4)}`;
                localStorage.setItem('userRole', role);
                localStorage.setItem('walletAddress', walletAddress);
                updateHeaderUI();
                closeLoginModal();
            }
            function logout() {
                localStorage.removeItem('userRole');
                localStorage.removeItem('walletAddress');
                updateHeaderUI();
            }
            closeLoginModalBtn.addEventListener('click', closeLoginModal);
            loginCreatorBtn.addEventListener('click', () => login('creator'));
            loginConsumerBtn.addEventListener('click', () => login('consumer'));

            // --- Create Modal Logic ---
            const createModal = document.getElementById('create-modal');
            const closeCreateModalBtn = document.getElementById('close-create-modal-btn');
            function showCreateModal() { createModal.classList.remove('hidden'); createModal.classList.add('flex'); }
            closeCreateModalBtn.addEventListener('click', () => {
                createModal.classList.add('hidden');
                createModal.classList.remove('flex');
            });
            
            // --- 3D Creator Preview & Add to Gallery Logic ---
            const imageUpload = document.getElementById('image-upload');
            const artTitleInput = document.getElementById('art-title');
            const artPriceInput = document.getElementById('art-price');
            const artDescriptionInput = document.getElementById('art-description'); // Get the new textarea
            const previewContainer = document.getElementById('create-preview-container');
            const addToGalleryBtn = document.getElementById('add-to-gallery-btn');
            let currentImageUrl = null; // This will hold the data:URL from upload OR remix
            
            imageUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        currentImageUrl = e.target.result; // Store base64 data URL
                        previewContainer.innerHTML = `<img src="${currentImageUrl}" alt="Preview" class="w-full h-full object-contain">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            addToGalleryBtn.addEventListener('click', () => {
                if (!currentImageUrl) { return showNotification("Please provide an image (upload or remix).", false); }
                if (!artTitleInput.value) { return showNotification("Please enter an artwork title.", false); }
                if (!artPriceInput.value || artPriceInput.value <= 0) { return showNotification("Please set a valid price.", false); }
                
                const title = artTitleInput.value;
                const price = parseFloat(artPriceInput.value);
                const description = artDescriptionInput.value.trim(); // Get description value
                const imageUrl = currentImageUrl; // Use the data:URL

                // Use description if provided, otherwise create a default one
                const cardDescription = description || `${title}. A newly created piece.`;

                const newCardHTML = `
                    <div class="group relative" data-description="${cardDescription}" data-image-url="${imageUrl}">
                        <img src="${imageUrl}" alt="${title}" class="gallery-image">
                        <div class="absolute inset-0 bg-black/60 card-overlay rounded-lg flex items-center justify-center space-x-2">
                            <button class="audio-btn p-3 bg-white/20 rounded-full hover:bg-white/30 transition-colors" aria-label="Play audio description">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                            </button>
                            <button class="remix-btn p-3 bg-white/20 rounded-full hover:bg-white/30 transition-colors" aria-label="Remix this art">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z" /></svg>
                            </button>
                            <button class="buy-now-btn font-bold bg-purple-600 text-white py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors">Buy Now</button>
                        </div>
                        <div class="mt-4 flex justify-between items-center">
                            <div>
                                <h3 class="text-xl font-bold">${title}</h3>
                                <p class="text-gray-400">By New Creator</p>
                            </div>
                            <div class="text-lg font-bold flex items-center gap-1">
                                <svg class="w-5 h-5" viewBox="0 0 320 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M311.9 260.8L160 353.6 8 260.8 160 0l151.9 260.8zM160 383.4L8 290.6 160 512l152-221.4-152 92.8z"/></svg>
                                ${price} ETH
                            </div>
                        </div>
                    </div>
                `;
                galleryGrid.insertAdjacentHTML('afterbegin', newCardHTML);
                
                // Reset form and close modal
                artTitleInput.value = ''; 
                artPriceInput.value = ''; 
                artDescriptionInput.value = ''; // Reset new field
                imageUpload.value = '';
                previewContainer.innerHTML = '<p class="placeholder-text">Your 3D preview will appear here</p>';
                currentImageUrl = null;
                createModal.classList.add('hidden'); createModal.classList.remove('flex');
            });


            // --- NEW: Remix Modal Logic ---
            const remixModal = document.getElementById('remix-modal');
            const closeRemixModalBtn = document.getElementById('close-remix-modal-btn');
            const saveRemixBtn = document.getElementById('save-remix-btn');
            const canvas = document.getElementById('remix-canvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;

            function showRemixModal(imageUrl, originalTitle) {
                remixModal.classList.remove('hidden');
                remixModal.classList.add('flex');
                
                // Store title
                canvas.dataset.originalTitle = originalTitle;
                
                // Load the image onto the canvas
                const img = new Image();
                img.crossOrigin = "anonymous"; // Attempt to prevent canvas tainting
                img.src = imageUrl;
                img.onload = () => {
                    // Clear canvas and draw image scaled to fit
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Calculate scaling to fit image
                    const hRatio = canvas.width / img.width;
                    const vRatio = canvas.height / img.height;
                    const ratio = Math.min(hRatio, vRatio); // Use min to fit and maintain aspect ratio
                    const centerShift_x = (canvas.width - img.width * ratio) / 2;
                    const centerShift_y = (canvas.height - img.height * ratio) / 2;
                    
                    ctx.drawImage(img, 0, 0, img.width, img.height, 
                                centerShift_x, centerShift_y, img.width * ratio, img.height * ratio);
                };
                img.onerror = (e) => {
                    console.error("Image loading error:", e);
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'center';
                    ctx.fillText('Could not load image (CORS policy?).', canvas.width / 2, canvas.height / 2);
                }
            }
            
            function closeRemixModal() {
                remixModal.classList.add('hidden');
                remixModal.classList.remove('flex');
                ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear on close
            }

            closeRemixModalBtn.addEventListener('click', closeRemixModal);

            // Drawing Logic
            function getMousePos(e) {
                const rect = canvas.getBoundingClientRect();
                // Handle mouse events
                if (e.clientX) {
                    return {
                        x: e.clientX - rect.left,
                        y: e.clientY - rect.top
                    };
                }
                // Handle touch events
                if (e.touches && e.touches[0]) {
                     return {
                        x: e.touches[0].clientX - rect.left,
                        y: e.touches[0].clientY - rect.top
                    };
                }
                return null;
            }

            function startDrawing(e) {
                const pos = getMousePos(e);
                if (!pos) return;
                isDrawing = true;
                ctx.beginPath();
                ctx.moveTo(pos.x, pos.y);
                e.preventDefault(); // Prevent page scrolling on touch
            }
            
            function stopDrawing(e) {
                isDrawing = false;
                ctx.beginPath();
                e.preventDefault();
            }

            function draw(e) {
                if (!isDrawing) return;
                
                const pos = getMousePos(e);
                if (!pos) return;

                ctx.lineWidth = 5;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#FFFFFF'; // White marker

                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
                
                e.preventDefault(); // Prevent page scrolling on touch
            }

            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            canvas.addEventListener('touchstart', startDrawing, { passive: false });
            canvas.addEventListener('touchend', stopDrawing, { passive: false });
            canvas.addEventListener('touchmove', draw, { passive: false });


            // Save Remix Logic
            saveRemixBtn.addEventListener('click', () => {
                let remixedImageDataURL;
                try {
                     // This is the line that will fail if the canvas is "tainted" by a CORS-protected image
                     remixedImageDataURL = canvas.toDataURL('image/png');
                } catch (e) {
                    console.error("Canvas toDataURL() failed:", e);
                    // This is the expected error when using placehold.co
                    showNotification("Could not save remix. The image is from a protected source (CORS error).", false);
                    return;
                }

                const originalTitle = canvas.dataset.originalTitle || 'Untitled';
                
                closeRemixModal();
                showCreateModal();

                // Pre-populate the Create Modal
                artTitleInput.value = `Remix of ${originalTitle}`;
                artDescriptionInput.value = `A remix of the piece "${originalTitle}".`;
                previewContainer.innerHTML = `<img src="${remixedImageDataURL}" alt="Remix Preview" class="w-full h-full object-contain">`;
                
                // Set the global variable used by the "Add to Gallery" button
                currentImageUrl = remixedImageDataURL;
                
                // Clear the file input, as we're using the canvas data
                imageUpload.value = '';
            });

            // --- Initial UI Setup ---
            updateHeaderUI();
        });
    </script>
</body>
</html>